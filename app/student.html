<!doctype html>
<html ng-app = "student">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
  <script>
    var app = angular.module('student', []);
    
    app.controller('teacherList', function($scope, $http, $rootScope){
      $scope.teachers = 'Just wait a second for our teachers to load';
      $scope.allClasses = [];
      $http({
        method: 'get', 
        url: '/allteachers'
      }).success(function(data, status){
        console.log(data);
        $scope.teachers = data;
        $scope.show = true;
      }).error(function(error){
        $rootScope.show = true
        console.log(error);
      });

      $http({
        method: 'get', 
        url: '/allclasses'
      }).success(function(data){
        console.log(data);
        $scope.allClasses = data;
      }).error(function(error){
        console.log(error);
      })

      $scope.getAssignments = function(name){
        $scope.teacher = name;
        $http({
          method: 'get', 
          url: '/getassignments/' + name
        }).success(function(data, status){
          console.log(data);
          $scope.assignments = data;
          $scope.show = false;
        }).error(function(error){
          console.log(error);
          $scope.show = false;
        })
      }


      $scope.joinClass = function(name){
        var alreadyThere = false;
        for (var i = 0 ; i < $scope.allClasses.length; i++){
          if ($scope.allClasses[i] === name){
            alreadyThere = true;
          }
        }
        if (!alreadyThere){
          $http({
            method: 'post', 
            url: '/students/joinclass/' + name, 
          }).success(function(data, status){
            console.log(data);
            $scope.allClasses.push({name: name});
          }).error(function(error){
            $scope.message = error;
          });
        }
      }
    });

  </script>
</head>

<body>
  <a href = "/logout">Logout</a>
  <div ng-controller = "teacherList">
    <h4>Current Classes</h4>
      <li ng-repeat = "teacher in allClasses | filter:searchTeacher">
        <a href = "#" ng-click = 'getAssignments(teacher.name)'>{{teacher.name}}</a>
      </li>
    <input type = "text" placeholder = "Search for your teacher" ng-model = "searchTeacher"  ng-show = "show" />
    <input type = "text" placeholder = "Search for an assignment" ng-model = "searchAssignment"  ng-show = "!show" />
    <ul ng-show = "show">
      <li ng-repeat = "teacher in teachers | filter:searchTeacher">
        <a href = "#" ng-click = 'getAssignments(teacher.name)'>{{teacher.name}}</a>
        <a ng-click = 'joinClass(teacher.name)'>Join this class</a>
      </li>
    </ul>
    <ul >
      <li ng-repeat = "assignment in assignments | filter:searchAssignment"><a ng-href = "/student/{{teacher}}/{{assignment.assignmentName}}">{{assignment.assignmentName}}</a></li>
    </ul>
    <h5>{{message}}</h5>
  </div>
</body>
</html>